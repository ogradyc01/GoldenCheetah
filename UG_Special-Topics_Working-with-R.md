#Using the R Chart

![R chart screenshot](https://raw.githubusercontent.com/GoldenCheetah/GoldenCheetah/master/doc/wiki/RChart.png)

The R chart is introduced with v4.0 of GoldenCheetah. The chart can be added to the activity view and the trend view. 

This 10 minute tutorial video introduces the R chart and setup and shows it in use.

[![Tutorial](https://raw.githubusercontent.com/GoldenCheetah/GoldenCheetah/master/doc/wiki/Rvideo.png)](https://vimeo.com/164812094)

In trend view the chart is refreshed when a date range or season is selected, or if the compare pane is updated. Whilst in the activity view the chart is refreshed when an activity is selected or, again, if the compare pane for intervals is updated.

When the chart is refreshed the user supplied R script is executed, and it should collect data and prepare a plot.

A simple example to plot HR might be:

```
ride <- GC.activity()
plot(ride$heart.rate)
```
This basically calls a GC function to fetch the data for the current ride and then uses the base R plot function to plot heart rate as a time series.

Similarly, in trend view, to plot a simple time series of average power for the current season:

```
metrics <- GC.metrics()
plot(metrics$Average_Power)
```

**Local Data, $$ and avoiding data refresh**

All data objects are shared across charts. If you create a vector 'x' in one chart it will be available in all the others. Usually, this is not a problem since you fetch the data manipulate it and plot it. But in some cases, where perhaps you prepare data from across the ride data you may want to avoid refreshing it to save time. 

If you prefix variable names with $$ then they will get a prefix added to them internally that makes them local to the chart. e.g. $$d internally becomes 'gc0d' on the first chart, 'gc1d' on the second and so on.

We recommend you always prefix variables with $$ to ensure there is not conflict across charts.

If you want to check if a variable exists and already contains values you can use the following code snippet:
```
> if (!exists("$$p")) print("doesn't exist")
[1] "doesn't exist"
> $$p <- 1
> if (exists("$$p")) print("does exist")
[1] "does exist"
```

If part of your code prepares large volumes of data, but doesn't need to refresh once its been created then this technique will help speed up your scripts.

**Compare Mode**

Where applicable the data access routines will offer a 'compare' parameter to access data; if FALSE it just returns the currently selected ride, if TRUE it will return a list. If compare mode is not active then the list will contain only one set of data for the currently selected ride. If compare is active it returns a list of all things being compared. See GC.activity(compare=TRUE) below for an example.

**Search/Filtering**

If a search or data filter is active then this will be applied to the results returned by the API methods described below. Even when all=TRUE is set to override season date ranges the filter will be applied. Ultimately, if the user doesn't want a filter to be applied they should clear it. We work this way to ensure consistency across all charts.

## Contents

Below you will find details of each of the GC functions available to use within the R chart.

__[Basics](#basics)__
* GC.version() to get a version string
* GC.build() to get a build number
* GC.display() to create a new graphics device
* GC.page(width=500, height=500) to set the page size

__[Athlete](#athlete)__
* GC.athlete() to get the athlete details

__[Activity](#activity)__
* GC.activities(filter="") to get a list of activities (as dates)
* GC.activity(activity=0,compare=FALSE) to get the activity data
* GC.activity.metrics(compare=FALSE) to get the activity metrics and metadata
* GC.activity.wbal(compare=FALSE) to get wbal series data
* GC.activity.meanmax(compare=FALSE) to get mean maximals for all activity data

__[Trends](#trends)__
* GC.season(all=FALSE, compare=FALSE) to get season details
* GC.season.metrics(all=FALSE, compare=FALSE) to get season metrics
* GC.season.meanmax(all=FALSE, compare=FALSE) to get best mean maximals for a season
* GC.season.peaks(all=FALSE, compare=FALSE, series, duration) to get activity peaks for a given series and duration 
* GC.season.pmc(all=FALSE, metric="TSS") to get PMC data for any given metric

R Script Examples
* [Power Distribution Plot](#power-density-plot)
* [Compare Mean Maximal Power](#compare-mean-maximal-power)
* [PMC Scatter Plot](#pmc-and-metric-plotting-together)

##Basics

All methods to access and work with GC objects and data within an R chart are prefixed with "GC." this is to ensure there is no namespace clash with other packages you may have installed. There are a number of methods available as listed below.

###GC.build() and GC.version()

GC.build will return the build number which increments with each release (including pre-release development builds), you can use this if you need to make a script dependant on the build. Additionally, GC.version will return a string describing the release,which could be put in files or on screen etc.

e.g:
```
> GC.build()
[1] 3941
> GC.version()
[1] "V4.0 DEV1604"
> 
```

###GC.display() and GC.page(width=500, height=500)

If you are familiar with the R device model (dev.cur, dev.list, dev.set) and frequently switch between graphics devices then you can create a new GC graphics device (to plot within the chart) by using GC.display(). If you are not familiar with the R device model then you should probably avoid using this function.

If you want to change the page size used for plotting you can set it with GC.page(). You express the page size in 72 dpi pixels. If you choose a very large size (e.g. 2500x1200) then be sure to have a large screen, since when scaled it will make the fonts very small indeed.

We typically use 500x500, 800x600 and 900x600 for scatter, histogram and time series plots. Be sure to set he page size before any plotting takes place. If you change page size mid-plot you will likely have issues. The command always returns 0.

NOTE: the page size is reset to 500x500 before every script run, so be sure to set it specifically in each plot. 

e.g. to set page size to 800x600
```
> GC.page(width=800, height=600)
integer(0)
>
```

##Athlete

###GC.athlete()

GC.athlete() will return a list of athlete details including name, home directory, gender, height, weight and date of birth.

e.g.
```
> GC.athlete()
$name
[1] "Mark Liversedge"

$home
[1] "/Users/markliversedge/Athletes/Mark Liversedge"

$dob
[1] "1967-07-03"

$weight
[1] 80

$height
[1] 1.83

$gender
[1] "male"

> 
```

##Activity

In the activity view you will work primarily with activities. The functions listed below return data related to the currently selected activity or are directly related to that context.

###GC.activities(filter="")

Will return a vector of POSIXct datetimes representing the start time for each activity. As the API matures it is expected that you will be able to reference a specific athletes activity via its start time.

e.g.
```
> d <- GC.activities()
> str(d)
 POSIXct[1:705], format: "2005-06-25 14:26:00" "2005-06-27 08:39:00" ...
> 
```

The filter parameter will be applied as a datafilter to limit the results, enabling you to select specific types of rides. You can pass multiple filters as a string vector.

e.g.
```
> l <- GC.activities(filter='Workout_Code="1L2"')
> str(l)
 POSIXct[1:65], format: "2008-12-29 12:33:49" "2009-02-12 12:00:00" ...
> 
```

###GC.activity(activity=0, compare=FALSE)

By default (compare=FALSE) it will return a data.frame representing the data for the currently selected ride. The column names have been selected to remain compatible with the trackeR package from UCL for analysing GPS based sports data.

The data.frame returned looks like this when using the 'str' command:

```
R Console (3.3.0)
> df <- GC.activity()
> str(df)
'data.frame':	3713 obs. of  21 variables:
 $ time        : POSIXct, format: "2016-05-04 15:00:19" "2016-05-04 15:00:20" ...
 $ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
 $ cadence     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ cadenced    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ heart.rate  : num  NA NA NA NA NA NA NA NA NA NA ...
 $ heart.rated : num  NA NA NA NA NA NA NA NA NA NA ...
 $ distance    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ speed       : num  5.1 5.1 5.38 5.65 5.93 ...
 $ acceleration: num  0 0 0.0772 0.0772 0.0772 ...
 $ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
 $ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
 $ power       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ powerd      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ altitude    : num  66 66 66 66 66 66 66 66 66 66 ...
 $ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
 $ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
 $ headwind    : num  5.1 5.1 5.38 5.65 5.93 ...
 $ slope       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ temperature : num  27 27 27 27 27 27 27 27 27 27 ...
 $ apower      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ gearratio   : num  0 0 0 0 0 0 0 0 0 0 ...
> 
```

Depending upon the data you have available in the activity you may see more columns, for example pedal based power meters and muscle oxygen devices will return additional data. In this example above you will see that heartrate and torque data is not recorded but still present in the data.frame -- the columns listed above will always be made available but will contan R's NA value if not actually recorded in the activity.

**GC.activity(compare=TRUE)**

If you pass the parameter compare=TRUE then the format returned is a list rather than a dataframe. The lis contains an entry for each ride being compared, or just the currently selected ride if compare is not active.

Each entry in the list contains two elements; 'color' a string you can use in 'col="xxx"' assignments, and 'activity' the data.frame in the same format as above.

e.g. with compare **not** active:

```
> df <- GC.activity(compare=TRUE)
> str(df)
Dotted pair list of 1
 $ :Dotted pair list of 2
  ..$ activity:'data.frame':	3713 obs. of  21 variables:
  .. ..$ time        : POSIXct[1:3713], format: "2016-05-04 15:00:19" "2016-05-04 15:00:20" ...
  .. ..$ seconds     : num [1:3713] 0 1 2 3 4 5 6 7 8 9 ...
  .. ..$ cadence     : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ cadenced    : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ heart.rate  : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ heart.rated : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ distance    : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ speed       : num [1:3713] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ acceleration: num [1:3713] 0 0 0.0772 0.0772 0.0772 ...
  .. ..$ torque      : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ torqued     : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ power       : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ powerd      : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ altitude    : num [1:3713] 66 66 66 66 66 66 66 66 66 66 ...
  .. ..$ longitude   : num [1:3713] -0.479 -0.479 -0.479 -0.479 -0.479 ...
  .. ..$ latitude    : num [1:3713] 51.1 51.1 51.1 51.1 51.1 ...
  .. ..$ headwind    : num [1:3713] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ slope       : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ temperature : num [1:3713] 27 27 27 27 27 27 27 27 27 27 ...
  .. ..$ apower      : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ gearratio   : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ color   : chr "#FF00FF"
> 
```

e.g. with compare active and two rides in the compare pane:

```
> df <- GC.activity(compare=TRUE)
> str(df)
Dotted pair list of 2
 $ :Dotted pair list of 2
  ..$ activity:'data.frame':	3712 obs. of  21 variables:
  .. ..$ time        : POSIXct[1:3712], format: "2016-05-04 15:00:19" "2016-05-04 15:00:20" ...
  .. ..$ seconds     : num [1:3712] 0 1 2 3 4 5 6 7 8 9 ...
  .. ..$ cadence     : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ cadenced    : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ heart.rate  : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ heart.rated : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ distance    : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ speed       : num [1:3712] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ acceleration: num [1:3712] 0 0 0.0772 0.0772 0.0772 ...
  .. ..$ torque      : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ torqued     : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ power       : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ powerd      : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ altitude    : num [1:3712] 66 66 66 66 66 66 66 66 66 66 ...
  .. ..$ longitude   : num [1:3712] -0.479 -0.479 -0.479 -0.479 -0.479 ...
  .. ..$ latitude    : num [1:3712] 51.1 51.1 51.1 51.1 51.1 ...
  .. ..$ headwind    : num [1:3712] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ slope       : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ temperature : num [1:3712] 27 27 27 27 27 27 27 27 27 27 ...
  .. ..$ apower      : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ gearratio   : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ color   : chr "#ff00ff"
 $ :Dotted pair list of 2
  ..$ activity:'data.frame':	4534 obs. of  21 variables:
  .. ..$ time        : POSIXct[1:4534], format: "2016-05-03 14:45:57" "2016-05-03 14:45:58" ...
  .. ..$ seconds     : num [1:4534] 0 1 2 3 4 5 6 7 8 9 ...
  .. ..$ cadence     : num [1:4534] 78 71 72 133 133 133 60 93 93 93 ...
  .. ..$ cadenced    : num [1:4534] 0 0 1 61 0 0 0 33 0 0 ...
  .. ..$ heart.rate  : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ heart.rated : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ distance    : num [1:4534] 0 0.006 0.012 0.012 0.012 0.014 0.02 0.02 0.02 0.02 ...
  .. ..$ speed       : num [1:4534] 0 24.8 30.7 30.7 30.7 ...
  .. ..$ acceleration: num [1:4534] 0 6.89 1.64 0 0 ...
  .. ..$ torque      : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ torqued     : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ power       : num [1:4534] 0 34 20 0 0 0 11 11 11 11 ...
  .. ..$ powerd      : num [1:4534] 0 34 0 0 0 0 11 0 0 0 ...
  .. ..$ altitude    : num [1:4534] -33 -32 -32 -32 -32 -32 -32 -32 -32 -32 ...
  .. ..$ longitude   : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ latitude    : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ headwind    : num [1:4534] 0 24.8 30.7 30.7 30.7 ...
  .. ..$ slope       : num [1:4534] 0 16.7 0 0 0 ...
  .. ..$ temperature : num [1:4534] 17 18 18 18 18 18 18 18 18 18 ...
  .. ..$ apower      : num [1:4534] 0 34 20 0 0 0 11 11 11 11 ...
  .. ..$ gearratio   : num [1:4534] 0 2.7 3 3 3 3 3.5 2.3 2.3 2.3 ...
  ..$ color   : chr "#00ffff"
> 
```

In this way, if you want to remain compatible with compare mode when charting you should always use 'compare=TRUE' and loop through the results to plot, taking care to overplot using 'lines', 'points' or 'curve'.

You can specify the activity (or activities) you want to fetch by using the parameter ```activity```. It should be set to a POSIXct datetime, or a vector. Remember that GC.activities() will return a vector of POSIXct representing each activity.

The example below retrieves raw sample data, in a dataframe for 13 rides where the 'Test' metadata flag is non-zero, e.g:

```
> list <- GC.activities(filter="Test <> 0")
> list
 [1] "2007-04-13 10:00:00 UTC" "2008-12-03 11:31:32 UTC"
 [3] "2009-01-24 15:11:21 UTC" "2009-02-07 11:38:22 UTC"
 [5] "2009-02-13 14:05:37 UTC" "2009-02-26 11:31:16 UTC"
 [7] "2009-03-09 12:35:23 UTC" "2009-04-20 10:33:16 UTC"
 [9] "2009-05-13 18:18:39 UTC" "2010-08-07 11:34:20 UTC"
[11] "2010-09-22 16:11:33 UTC" "2012-05-28 18:04:02 UTC"
[13] "2015-10-22 15:57:58 UTC"
> rides <- GC.activity(list)
> str(rides)
'data.frame':	13 obs. of  13 variables:
 $ activity:'data.frame':	2817 obs. of  18 variables:
  ..$ time        : POSIXct, format: "2007-04-13 10:00:00" "2007-04-13 10:00:01" ...
  ..$ seconds     : num  0 1.26 2.52 3.78 5.04 ...
  ..$ cadence     : num  93 93 59 99 103 76 76 76 93 93 ...
  ..$ cadenced    : num  0 0 0 31.75 3.17 ...
  ..$ heart.rate  : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ heart.rated : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ distance    : num  0 0.013 0.027 0.044 0.059 0.074 0.088 0.103 0.118 0.13 ...
  ..$ speed       : num  39.9 39.9 42.3 43.5 43.6 43.5 43.5 43.5 42.1 41.5 ...
  ..$ acceleration: num  0 0 0.529 0.265 0.022 ...
  ..$ torque      : num  5.2 5.2 5.6 5 5.4 6.9 6.9 6.9 8.9 8.5 ...
  ..$ torqued     : num  0 0 0.317 -0.476 0.317 ...
  ..$ power       : num  173 173 199 180 197 249 249 249 313 293 ...
  ..$ powerd      : num  0 0 20.6 0 13.5 ...
  ..$ altitude    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ longitude   : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ latitude    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ gearratio   : num  3 3 3 3 3 4.5 4.5 4.5 3.5 3.5 ...
 $         :'data.frame':	4029 obs. of  18 variables:
  ..$ time        : POSIXct, format: "2008-12-03 11:31:32" "2008-12-03 11:31:33" ...
  ..$ seconds     : num  0 1.26 2.52 3.78 5.04 ...
  ..$ cadence     : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ cadenced    : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ heart.rate  : num  78 80 82 83 85 84 83 83 81 81 ...
  ..$ heart.rated : num  0 1.587 1.587 0.794 1.587 ...
  ..$ distance    : num  0 0 0 0.002 0.002 0.002 0.002 0.002 0.002 0.004 ...
  ..$ speed       : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ acceleration: num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ torque      : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ torqued     : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ power       : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ powerd      : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ altitude    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ longitude   : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ latitude    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 0 0 0 ...
 $         :'data.frame':	4523 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2009-01-24 15:11:21" "2009-01-24 15:11:22" ...
  ..$ seconds     : num  0 1 2 5 6 7 8 9 10 11 ...
  ..$ cadence     : num  0 0 0 0 2 2 16 38 51 60 ...
  ..$ cadenced    : num  0 0 0 0 2 0 14 22 13 9 ...
  ..$ heart.rate  : num  75 75 74 75 75 75 77 80 81 86 ...
  ..$ heart.rated : num  0 0 -1 0.333 0 ...
  ..$ distance    : num  0 0 0.004 0.004 0.006 0.01 0.014 0.021 0.027 0.032 ...
  ..$ speed       : num  0 0.5 4.3 2.6 6.3 14 15.6 21.9 22.9 19.7 ...
  ..$ acceleration: num  0 0.139 1.056 -0.157 1.028 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 0 0 0 0 329 500 477 561 ...
  ..$ powerd      : num  0 0 0 0 0 0 329 171 0 84 ...
  ..$ altitude    : num  166 166 166 166 166 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 -2.5 0 0 ...
  ..$ apower      : num  0 0 0 0 0 ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 3.5 3.5 2.6 ...
 $         :'data.frame':	4279 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2009-02-07 11:38:22" "2009-02-07 11:38:23" ...
  ..$ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
  ..$ cadence     : num  0 0 0 0 0 0 0 4 16 34 ...
  ..$ cadenced    : num  0 0 0 0 0 0 0 4 12 18 ...
  ..$ heart.rate  : num  90 91 93 92 92 95 93 96 97 96 ...
  ..$ heart.rated : num  0 1 2 -1 0 3 -2 3 1 -1 ...
  ..$ distance    : num  0 0 0 0.002 0.003 0.005 0.007 0.011 0.016 0.022 ...
  ..$ speed       : num  0 0.2 0.6 5.6 3.6 7.1 8.6 13.4 17.5 21.7 ...
  ..$ acceleration: num  0 0.0556 0.1111 1.3889 -0.5556 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 0 0 15 15 15 246 473 551 ...
  ..$ powerd      : num  0 0 0 0 15 0 0 231 227 78 ...
  ..$ altitude    : num  142 142 142 141 141 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 0 -5 -10 5 -15 5 -6 0 ...
  ..$ apower      : num  0 0 0 0 15.1 ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 0 0 5 ...
 $         :'data.frame':	4020 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2009-02-13 14:05:37" "2009-02-13 14:05:38" ...
  ..$ seconds     : num  0 1 2 5 6 7 8 9 10 11 ...
  ..$ cadence     : num  14 0 5 5 19 35 35 46 46 52 ...
  ..$ cadenced    : num  0 0 5 0 14 16 0 11 0 6 ...
  ..$ heart.rate  : num  67 67 67 69 68 68 70 71 74 78 ...
  ..$ heart.rated : num  0 0 0 0.667 -1 ...
  ..$ distance    : num  0 0 0.007 0.009 0.013 0.017 0.023 0.029 0.036 0.043 ...
  ..$ speed       : num  0 0 7.8 7.9 14.3 17.3 19.9 21.3 24.1 26 ...
  ..$ acceleration: num  0 0 2.16667 0.00926 1.77778 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  2 0 6 6 266 370 370 308 407 477 ...
  ..$ powerd      : num  0 0 6 0 260 104 0 0 99 70 ...
  ..$ altitude    : num  -24.1 -24.1 -24.1 -24.5 -24.7 -24.8 -24.3 -24.6 -24.4 -24.6 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 0 -20 -5 ...
  ..$ apower      : num  2 0 6 6 266 370 370 308 407 477 ...
  ..$ gearratio   : num  0 0 0 0 3.5 3.5 3.5 3.5 3.5 3.5 ...
 $         :'data.frame':	3840 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2009-02-26 11:31:16" "2009-02-26 11:31:17" ...
  ..$ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
  ..$ cadence     : num  0 0 0 0 0 0 0 9 9 49 ...
  ..$ cadenced    : num  0 0 0 0 0 0 0 9 0 40 ...
  ..$ heart.rate  : num  63 63 63 63 64 64 65 66 69 71 ...
  ..$ heart.rated : num  0 0 0 0 1 0 1 1 3 2 ...
  ..$ distance    : num  0 0.001 0.001 0.002 0.004 0.006 0.009 0.014 0.02 0.027 ...
  ..$ speed       : num  0 2.1 2.2 3.5 5.7 7.3 13.1 17.6 20.6 23.5 ...
  ..$ acceleration: num  0 0.5833 0.0278 0.3611 0.6111 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 0 0 0 0 0 482 482 563 ...
  ..$ powerd      : num  0 0 0 0 0 0 0 482 0 81 ...
  ..$ altitude    : num  -42.3 -42.3 -42.3 -42.3 -42.2 -42.2 -42.2 -42 -42.2 -42.3 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 0 0 5 ...
  ..$ apower      : num  0 0 0 0 0 0 0 482 482 563 ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 0 0 3.5 ...
 $         :'data.frame':	3706 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2009-03-09 12:35:23" "2009-03-09 12:35:24" ...
  ..$ seconds     : num  0 1 3 4 5 6 7 8 9 10 ...
  ..$ cadence     : num  0 7 7 7 22 22 38 50 50 64 ...
  ..$ cadenced    : num  0 7 0 0 15 0 16 12 0 14 ...
  ..$ heart.rate  : num  85 84 85 85 87 88 91 93 95 98 ...
  ..$ heart.rated : num  0 -1 0.5 0 2 1 3 2 2 3 ...
  ..$ distance    : num  0 0.001 0.005 0.007 0.01 0.015 0.021 0.027 0.034 0.042 ...
  ..$ speed       : num  0 1.9 15.7 5.6 12.4 16.4 20.1 22.5 25.7 27.5 ...
  ..$ acceleration: num  0 0.528 1.917 -2.806 1.889 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 7 7 314 314 486 498 541 559 ...
  ..$ powerd      : num  0 0 3.5 0 307 0 172 12 43 18 ...
  ..$ altitude    : num  77 77 76.5 76.6 77.5 77 76.7 77 76.6 76.6 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 -12.5 5 5 ...
  ..$ apower      : num  0 0 7.03 7.03 315.32 ...
  ..$ gearratio   : num  0 0 0 4 4 4 4 4 4 3 ...
 $         :'data.frame':	4781 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2009-04-20 10:33:16" "2009-04-20 10:33:17" ...
  ..$ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
  ..$ cadence     : num  0 0 0 0 0 0 0 0 0 10 ...
  ..$ cadenced    : num  0 0 0 0 0 0 0 0 0 10 ...
  ..$ heart.rate  : num  76 76 77 78 78 79 80 79 80 81 ...
  ..$ heart.rated : num  0 0 1 1 0 1 1 -1 1 1 ...
  ..$ distance    : num  0 0 0 0 0.001 0.002 0.004 0.006 0.008 0.011 ...
  ..$ speed       : num  0 0.3 0.1 0 1.8 5.9 6.2 6 8.4 11.3 ...
  ..$ acceleration: num  0 0.0833 -0.0556 -0.0278 0.5 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 0 0 0 0 8 8 8 151 ...
  ..$ powerd      : num  0 0 0 0 0 0 8 0 0 143 ...
  ..$ altitude    : num  49.8 49.8 49.8 49.8 49.5 49.5 49.5 49.6 49.7 49.5 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 0 0 0 ...
  ..$ apower      : num  0 0 0 0 0 ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 0 0 0 ...
 $         :'data.frame':	4517 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2009-05-13 18:18:39" "2009-05-13 18:18:40" ...
  ..$ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
  ..$ cadence     : num  2 46 46 46 46 16 19 19 34 47 ...
  ..$ cadenced    : num  0 44 0 0 0 0 3 0 15 13 ...
  ..$ heart.rate  : num  69 68 68 69 69 70 72 73 75 78 ...
  ..$ heart.rated : num  0 -1 0 1 0 1 2 1 2 3 ...
  ..$ distance    : num  0 0 0 0.002 0.004 0.006 0.009 0.013 0.018 0.022 ...
  ..$ speed       : num  0 0 0.3 7.1 6.6 8.3 11.6 14.6 14.8 14.6 ...
  ..$ acceleration: num  0 0 0.0833 1.8889 -0.1389 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 0 0 0 0 193 193 120 330 ...
  ..$ powerd      : num  0 0 0 0 0 0 193 0 0 210 ...
  ..$ altitude    : num  77.3 77.3 77.3 77.3 77.3 77.4 77.5 77.7 77.5 77.9 ...
  ..$ longitude   : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ latitude    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 0 0 0 ...
  ..$ apower      : num  0 0 0 0 0 ...
  ..$ gearratio   : num  0 0 0 0 0 0 4.5 6 3 2.4 ...
 $         :'data.frame':	5532 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2010-08-07 11:34:20" "2010-08-07 11:34:21" ...
  ..$ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
  ..$ cadence     : num  0 0 0 0 0 2 2 2 0 0 ...
  ..$ cadenced    : num  0 0 0 0 0 2 0 0 0 0 ...
  ..$ heart.rate  : num  103 101 100 95 95 96 97 97 97 96 ...
  ..$ heart.rated : num  0 -2 -1 -5 0 1 1 0 0 -1 ...
  ..$ distance    : num  0 0 0 0 0.00216 ...
  ..$ speed       : num  0 0 0 0 7.78 ...
  ..$ acceleration: num  0 0 0 0 2.16 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ powerd      : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ altitude    : num  58.8 58.8 58.8 57.3 57.6 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 0 0 13.2 ...
  ..$ apower      : num  0 0 0 0 0 0 0 0 0 0 ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 0 0 0 ...
 $         :'data.frame':	4751 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2010-09-22 16:11:33" "2010-09-22 16:11:34" ...
  ..$ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
  ..$ cadence     : num  111 111 0 0 0 0 0 0 0 31 ...
  ..$ cadenced    : num  0 0 0 0 0 0 0 0 0 31 ...
  ..$ heart.rate  : num  76 76 77 78 78 80 81 83 84 86 ...
  ..$ heart.rated : num  0 0 1 1 0 2 1 2 1 2 ...
  ..$ distance    : num  0 0 0.000706 0.001412 0.003733 ...
  ..$ speed       : num  0 0 2.54 2.54 8.36 ...
  ..$ acceleration: num  0 0 0.706 0 1.615 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  5 5 0 0 0 0 0 0 0 157 ...
  ..$ powerd      : num  0 0 0 0 0 0 0 0 0 157 ...
  ..$ altitude    : num  42.5 42.5 42.5 42.5 42.8 ...
  ..$ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
  ..$ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 1.27 1.56 12.19 ...
  ..$ apower      : num  5.01 5.01 0 0 0 ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 0 0 3 ...
 $         :'data.frame':	3346 obs. of  20 variables:
  ..$ time        : POSIXct, format: "2012-05-28 18:04:02" "2012-05-28 18:04:03" ...
  ..$ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
  ..$ cadence     : num  127 0 55 55 55 0 0 36 38 46 ...
  ..$ cadenced    : num  0 0 55 0 0 0 0 36 2 8 ...
  ..$ heart.rate  : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ heart.rated : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ distance    : num  0.0 0.0 0.0 3.8e-05 2.2e-03 ...
  ..$ speed       : num  0 0 0 0.137 7.801 ...
  ..$ acceleration: num  0 0 0 0.038 2.129 ...
  ..$ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ power       : num  0 0 0 0 0 0 0 0 261 291 ...
  ..$ powerd      : num  0 0 0 0 0 0 0 0 261 30 ...
  ..$ altitude    : num  17.9 35.9 35.9 35.9 36 ...
  ..$ longitude   : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ latitude    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ headwind    : num  NA NA NA NA NA NA NA NA NA NA ...
  ..$ slope       : num  0 0 0 0 3.65 ...
  ..$ apower      : num  0 0 0 0 0 ...
  ..$ gearratio   : num  0 0 0 0 0 0 0 0 2.7 2.4 ...
 $         :'data.frame':	0 obs. of  17 variables:
  ..$ time        :Classes 'POSIXct', 'POSIXt'  atomic (0) 
  ..- attr(*, "tzone")= chr "UTC"
  ..$ seconds     : num 
  ..$ cadence     : num 
  ..$ cadenced    : num 
  ..$ heart.rate  : num 
  ..$ heart.rated : num 
  ..$ distance    : num 
  ..$ speed       : num 
  ..$ acceleration: num 
  ..$ torque      : num 
  ..$ torqued     : num 
  ..$ power       : num 
  ..$ powerd      : num 
  ..$ altitude    : num 
  ..$ longitude   : num 
  ..$ latitude    : num 
  ..$ headwind    : num 
> 
```
####Power Density Plot
Here is a script that plots density distributions for power and is compatible with compare mode:
```
## R script will run on selection.
##
## GC.activity(compare=TRUE)
## GC.metrics(all=FALSE)
##
## Get the current ride or metrics
##

# get a list of activities, will have one member
# if not in compare mode, or multiple if we are
# in compare mode
d <- GC.activity(compare=TRUE)

## set plot limits
maxy <-0
maxx <-0

for (compare in d) {

   # get the activity being compared
   power <- compare$activity$power

   # density
   k <- density(power)

   # max on x axis
   mx <- max(power)
   if (mx > maxx) maxx <- mx;

   # max on y axis
   my <- max(k$y)
   if (my > maxy) maxy <- my;
}

## create a blank plot
plot(k, ylim = c(0,maxy), xlim=c(0,maxx), 
     col="black", main="", xlab="", yaxt="n")

title(main="Power Distribution", 
      xlab = "Watts")

## add density
for (compare in d) {

    # just the ride
    power <- compare$activity$power

    k <- density(power)
    if (length(d)==1) lines(k, col="green")
    else lines(k, col=compare$color)
}
```
**As you may have guessed the script in an R chart will be re-run when an activity is selected or compare pane changes (you add or deselect an activity etc).**

###GC.activity.metrics(compare=FALSE)

Will retrieve a data.frame of the metric and metadata fields for the current activity. This also includes the ride color according to the current config. If compare is true it will return a list.

**NOTE** there is a metric called ```Checksum``` which is a CRC generated for the activity. It is based upon the activity raw data, metadata and start date and time. It will change when the activity data changes and is therefore a useful value to use with the ```R.cache``` and ```memoise``` R packages for caching previously computed values.

e.g. metrics for the current activity:
```
> metrics <- GC.activity.metrics()
> str(metrics)
'data.frame':	1 obs. of  301 variables:
 $ date                                 : Date, format: "2016-05-05"
 $ time                                 : POSIXct, format: "2016-05-05 11:57:18"
 $ axPower                              : num 160
 $ aPower_Relative_Intensity            : num 0.711
 $ aBikeScore                           : num 53.2
 $ Skiba_aVI                            : num 1.18
 $ aPower_Response_Index                : num 1.43
 $ aNP                                  : num 175
 $ aIF                                  : num 0.777
 $ aTSS                                 : num 61.7
 $ aVI                                  : num 1.29
 $ aPower_Efficiency_Factor             : num 1.57
 $ aTSS_per_hour                        : num 58.3
 $ Aerobic_Decoupling                   : num 0
 $ Activities                           : num 1
 $ To_Exhaustion                        : num 0
 $ Duration                             : num 3812
 $ Time_Moving                          : num 3673
 $ Time_Carrying                        : num 4
 $ Elevation_Gain_Carrying              : num 0
 $ Distance                             : num 25.6
 $ Distance_Swim                        : num 25573
 $ Climb_Rating                         : num 1.69
 $ Athlete_Weight                       : num 91.1
 $ Athlete_Bodyfat                      : num 0
 $ Athlete_Lean_Weight                  : num 0
 $ Athlete_Bodyfat_Percent              : num 0
 $ Elevation_Gain                       : num 208
 $ Elevation_Loss                       : num 202
 $ Work                                 : num 497
 $ Average_Speed                        : num 25.1
 $ Pace                                 : num 2.39
 $ Pace_Swim                            : num 0.239
 $ Average_Power                        : num 135
 $ Average_SmO2                         : num 0
 $ Average_tHb                          : num 0
 $ Average_aPower                       : num 136
 $ Nonzero_Average_Power                : num 159
 $ Average_Heart_Rate                   : num 112
 $ Average_Core_Temperature             : num 36
 $ Heartbeats                           : num 7.45
 $ HrPw_Ratio                           : num 1.21
 $ Workbeat_stress                      : num 0.037
 $ Watts:RPE_Ratio                      : num 0
 $ Power_Percent_of_Max                 : num 17.3
 $ HrNp_Ratio                           : num 1.55
 $ Average_Cadence                      : num 76
 $ Average_Temp                         : num 21.9
 $ Max_Power                            : num 601
 $ Max_SmO2                             : num 0
 $ Max_tHb                              : num 0
 $ Min_SmO2                             : num 0
 $ Min_tHb                              : num 0
 $ Max_Heartrate                        : num 112
 $ Min_Heartrate                        : num 111
 $ Max_Core_Temperature                 : num 37
 $ Max_Speed                            : num 55.7
 $ Max_Cadence                          : num 139
 $ Max_Temp                             : num 25
 $ Min_Temp                             : num 21
 $ 95%_Heartrate                        : num 0
 $ VAM                                  : num 196
 $ EOA                                  : num 0.692
 $ Gradient                             : num 0.813
 $ Average_Power_Variance               : num 57.9
 $ Max_Power_Variance                   : num 601
 $ Average_Left_Torque_Effectiveness    : num 0
 $ Average_Right_Torque_Effectiveness   : num 0
 $ Average_Left_Pedal_Smoothness        : num 0
 $ Average_Right_Pedal_Smoothness       : num 0
 $ Average_Left_Pedal_Center_Offset     : num 0
 $ Average_Right_Pedal_Center_Offset    : num 0
 $ Average_Left_Power_Phase_Start       : num 0
 $ Average_Right_Power_Phase_Start      : num 0
 $ Average_Left_Power_Phase_End         : num 0
 $ Average_Right_Power_Phase_End        : num 0
 $ Average_Left_Peak_Power_Phase_Start  : num 0
 $ Average_Right_Peak_Power_Phase_Start : num 0
 $ Average_Left_Peak_Power_Phase_End    : num 0
 $ Average_Right_Peak_Power_Phase_End   : num 0
 $ Average_Left_Power_Phase_Length      : num 0
 $ Average_Right_Power_Phase_Length     : num 0
 $ Average_Peak_Left_Power_Phase_Length : num 0
 $ Average_Right_Peak_Power_Phase_Length: num 0
 $ Calories                             : num 635
 $ Aerobic_TISS                         : num 55.5
 $ Anaerobic_TISS                       : num 1.95
 $ CP_setting                           : num 225
 $ xPower                               : num 159
 $ Relative_Intensity                   : num 0.706
 $ BikeScore&#8482;                     : num 52.5
 $ Skiba_VI                             : num 1.17
 $ TISS_Aerobicity                      : num 96.6
 $ Response_Index                       : num 1.42
 $ NP                                   : num 174
 $ IF                                   : num 0.772
 $ TSS                                  : num 60.8
 $ VI                                   : num 1.28
 $ Efficiency_Factor                    : num 1.55
  [list output truncated]
> 
```
###GC.activity.wbal(compare=FALSE)

Because the W'bal data series is always calculated in 1 second intervals it is not returned with the activity data data.frame -- it would cause problems when data is recorded in 0.5 seconds from a track PM or 1.26s by an old Powertap.

Instead, we return it a simple vector of values, and when using compare mode is in a list in the same way as the other activity data.

e.g. plain, no compare active:
```
> wbal <- GC.activity.wbal()
> str(wbal)
 num [1:4227] 19000 19000 19000 19000 19000 19000 19000 19000 19000 19000 ...
> 
```

e.g. with compare:
```
> wc <- GC.activity.wbal(compare=TRUE)
> str(wc)
Dotted pair list of 2
 $ :Dotted pair list of 2
  ..$ activity: num [1:4226] 19000 19000 19000 19000 19000 19000 19000 19000 19000 19000 ...
  ..$ color   : chr "#ff00ff"
 $ :Dotted pair list of 2
  ..$ activity: num [1:4534] 19000 19000 19000 19000 19000 19000 19000 19000 19000 19000 ...
  ..$ color   : chr "#00ffff"
> 
```

###GC.activity.meanmax(compare=FALSE)

Mean maximal data is returned in a data.frame, with a column for each data series that has mean max data computed. This is a subset of all the data that can be made available (the cache size is expensive and we don't want to cache data that is never or very, very rarely used).

As with the other activity functions it will return a list of a single data.frame of mean maximal series for the ride.

The series is always computed to 1 second intervals, so the returned data contains peak values from 1s through to the end of the activity

e.g. Mean-max for an activity:
```
> mm <- GC.activity.meanmax()
> str(mm)
'data.frame':	4228 obs. of  8 variables:
 $ power  : num  557 529 517 504 ...
 $ wpk    : num  6.24 5.93 5.79 5.64 ...
 $ cadence: num  97 97 95 93 ...
 $ speed  : num  53.5 53.2 53 52.6 ...
 $ vam    : num  3600 3600 2400 2700 ...
 $ NP     : num  393 392 391 390 ...
 $ apower : num  559 531 519 506 ...
 $ xpower : num  340 339 338 338 ...
> 
```

##Trends

When plotting in the trends view you are looking at data across a date range or season (as selected in the sidebar). These functions return data in that context.

### GC.season(all=FALSE, compare=FALSE)

Will return a data.frame of seasons, by default it contains one item for the currently selected season but if all is TRUE it will return all seasons configured, and if compare is TRUE will return all seasons being compared. If compare is TRUE and compare is not active it will return the currently selected season.

NOTE: season colors are always set to gray unless in compare mode, in which case they are the compare mode
color, to enable use in a plot legend using legend(legend=season$name, fill=season$color ...).

e.g. list all seasons
```
> GC.season(all=TRUE)
             name      start        end   color
1    2016 Cycling 2016-04-04 2016-09-01 #7f7f7f
2            2015 2014-07-29 2015-01-11 #7f7f7f
3            2014 2014-07-12 2015-01-23 #7f7f7f
4            2010 2010-01-01 2011-01-01 #7f7f7f
5       Late 2009 2009-04-01 2009-08-01 #7f7f7f
6        Mid 2009 2009-01-01 2009-04-01 #7f7f7f
7      Early 2009 2008-08-01 2009-01-01 #7f7f7f
8            2009 2008-08-01 2009-09-01 #7f7f7f
9            2007 2006-07-01 2007-08-01 #7f7f7f
10      All Dates 1966-05-07 2066-05-07 #7f7f7f
11      This Year 2016-01-01 2016-12-31 #7f7f7f
12     This Month 2016-05-01 2016-05-31 #7f7f7f
13     Last Month 2016-04-01 2016-04-30 #7f7f7f
14      This Week 2016-05-02 2016-05-08 #7f7f7f
15      Last Week 2016-04-25 2016-05-01 #7f7f7f
16    Last 7 days 2016-05-01 2016-05-07 #7f7f7f
17   Last 14 days 2016-04-24 2016-05-07 #7f7f7f
18   Last 21 days 2016-04-17 2016-05-07 #7f7f7f
19   Last 28 days 2016-04-10 2016-05-07 #7f7f7f
20  Last 2 months 2016-03-07 2016-05-07 #7f7f7f
21  Last 3 months 2016-02-07 2016-05-07 #7f7f7f
22  Last 6 months 2015-11-07 2016-05-07 #7f7f7f
23 Last 12 months 2015-05-07 2016-05-07 #7f7f7f
> 
```

### GC.season.meanmax(all=FALSE, compare=FALSE)

As for activity above this will return a data.frame of mean maximals for data series. Since vectors in a data.frame must all have the same length they will be zero padded to the longest series.

If you use all and compare together you will get mean maximals for all activities in a list.

e.g. mean maximal for current season:
```
> mm <- GC.season.meanmax()
> str(mm)
'data.frame':	4228 obs. of  8 variables:
 $ power  : num  557 529 517 504 ...
 $ wpk    : num  6.24 5.93 5.79 5.64 ...
 $ cadence: num  97 97 95 93 ...
 $ speed  : num  53.5 53.2 53 52.6 ...
 $ vam    : num  3600 3600 2400 2700 ...
 $ NP     : num  393 392 391 390 ...
 $ apower : num  559 531 519 506 ...
 $ xpower : num  340 339 338 338 ...
> 
```

####Compare Mean Maximal Power
e.g. plotting comparisons of mean maximal power
```
## plot meanmax
GC.page(width=800,height=600)

## get data
compares <- GC.season.meanmax(compare=TRUE)

plot(compares[[1]]$meanmax$power, 
     type="n",
     log="xy",
     ylab="Watts",
     xlab="Seconds",
     ylim=c(100,1000), xlim=c(1,10000))

for(compare in compares) {
   points(compare$meanmax$power,
          col=compare$color,
          pch=20)
}
``` 

NOTE: when plotting with log scales you cannot set the scales (ylim/xlim) from 0 since log(0) is infinite. Instead in the example above the data is limited to 100 and 1 for Y and X scales respectively.

### GC.season.metrics(all=FALSE, compare=FALSE)

Will fetch the metrics for rides in the currently selected date range, or all dates if all=TRUE. As you would expect the compare parameter will return a list.

Of note here are the metadata fields are also returned in the data.frame, a date field as well as a datetime field and the ride color as applied using the GC coloring rules. Color is a text string in "#rrggbb" format.

It is common to use the color column to control coloring on the plots.

e.g. fetching metrics for the current date range:
```
> metrics <- GC.season.metrics()
> str(metrics)
'data.frame':	245 obs. of  301 variables:
 $ date                                 : Date, format: "2008-08-14" "2008-08-16" ...
 $ time                                 : POSIXct, format: "2008-08-14 16:45:52" "2008-08-16 12:00:26" ...
 $ axPower                              : num  168 200 211 193 0 ...
 $ aPower_Relative_Intensity            : num  0.67 0.799 0.845 0.77 0 ...
 $ aBikeScore                           : num  68.1 232.2 123.2 128.1 0 ...
 $ Skiba_aVI                            : num  1.19 1.22 1.23 1.15 0 ...
 $ aPower_Response_Index                : num  Inf 1.39 1.64 1.55 0 ...
 $ aNP                                  : num  179 210 221 201 0 ...
 $ aIF                                  : num  0.715 0.839 0.884 0.804 0 ...
 $ aTSS                                 : num  75.2 254.3 134.6 139.3 0 ...
 $ aVI                                  : num  1.27 1.28 1.28 1.2 0 ...
 $ aPower_Efficiency_Factor             : num  Inf 1.46 1.71 1.62 0 ...
 $ aTSS_per_hour                        : num  49.6 63.9 78.1 64.6 0 ...
 $ Aerobic_Decoupling                   : num  0 17.59 15.39 9.27 0 ...
 $ Activities                           : num  1 1 1 1 1 1 1 1 1 1 ...
 $ To_Exhaustion                        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Duration                             : num  5454 14330 6210 7764 1611 ...
 $ Time_Moving                          : num  5287 12891 6165 7699 520 ...
 $ Time_Carrying                        : num  0 0 0 0 0 0 0 0 118 0 ...
 $ Elevation_Gain_Carrying              : num  0 0 0 0 0 ...
 $ Distance                             : num  28.48 77.412 33.96 45.284 0.727 ...
 $ Distance_Swim                        : num  28480 77412 33960 45284 727 ...
 $ Climb_Rating                         : num  0 0 0 0 0.235 ...
 $ Athlete_Weight                       : num  89 89 89 89 85 89 89 89 89 89 ...
 $ Athlete_Bodyfat                      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Athlete_Lean_Weight                  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Athlete_Bodyfat_Percent              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Elevation_Gain                       : num  0 0 0 0 13.1 ...
 $ Elevation_Loss                       : num  0 0 0 0 13.1 ...
 $ Work                                 : num  746 2138 1068 1297 0 ...
 $ Average_Speed                        : num  19.65 22.91 20.44 21.86 5.04 ...
 $ Pace                                 : num  3.05 2.62 2.93 2.74 11.92 ...
 $ Pace_Swim                            : num  0.305 0.262 0.293 0.274 1.192 ...
 $ Average_Power                        : num  141 164 172 167 0 ...
 $ Average_SmO2                         : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_tHb                          : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_aPower                       : num  141 164 172 167 0 ...
 $ Nonzero_Average_Power                : num  143 176 179 174 0 ...
 $ Average_Heart_Rate                   : num  0 144 129 124 0 ...
 $ Average_Core_Temperature             : num  0 38 37.9 37.8 0 ...
 $ Heartbeats                           : num  0 31150 13314 16023 0 ...
 $ HrPw_Ratio                           : num  0 1.14 1.33 1.35 0 ...
 $ Workbeat_stress                      : num  0 666 142 208 0 ...
 $ Watts:RPE_Ratio                      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Power_Percent_of_Max                 : num  15.7 18.3 19.1 18.6 0 ...
 $ HrNp_Ratio                           : num  0 1.46 1.71 1.62 0 ...
 $ Average_Cadence                      : num  64.6 68.9 68.8 76 0 ...
 $ Average_Temp                         : num  -255 -255 -255 -255 -255 -255 -255 -255 -255 -255 ...
 $ Max_Power                            : num  692 804 760 647 0 582 731 607 0 692 ...
 $ Max_SmO2                             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Max_tHb                              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Min_SmO2                             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Min_tHb                              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Max_Heartrate                        : num  0 177 170 163 0 170 169 177 171 175 ...
 $ Min_Heartrate                        : num  0 70 59 84 0 82 75 73 65 67 ...
 $ Max_Core_Temperature                 : num  0 38.9 38.4 38.2 0 ...
 $ Max_Speed                            : num  43 59.2 44.1 51 10.1 ...
 $ Max_Cadence                          : num  244 244 244 244 0 244 244 244 0 183 ...
 $ Max_Temp                             : num  -255 -255 -255 -255 -255 -255 -255 -255 -255 -255 ...
 $ Min_Temp                             : num  -255 -255 -255 -255 -255 -255 -255 -255 -255 -255 ...
 $ 95%_Heartrate                        : num  0 168 158 143 0 161 158 163 168 160 ...
 $ VAM                                  : num  0 0 0 0 29.2 ...
 $ EOA                                  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Gradient                             : num  0 0 0 0 1.8 ...
 $ Average_Power_Variance               : num  89.8 81.4 70.5 69.4 0 ...
 $ Max_Power_Variance                   : num  692 804 747 469 0 535 668 580 0 692 ...
 $ Average_Left_Torque_Effectiveness    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Torque_Effectiveness   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Pedal_Smoothness        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Pedal_Smoothness       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Pedal_Center_Offset     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Pedal_Center_Offset    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Power_Phase_Start       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Power_Phase_Start      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Power_Phase_End         : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Power_Phase_End        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Peak_Power_Phase_Start  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Peak_Power_Phase_Start : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Peak_Power_Phase_End    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Peak_Power_Phase_End   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Power_Phase_Length      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Power_Phase_Length     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Peak_Left_Power_Phase_Length : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Peak_Power_Phase_Length: num  0 0 0 0 0 0 0 0 0 0 ...
 $ Calories                             : num  0 3162 1283 1507 0 ...
 $ Aerobic_TISS                         : num  80.2 246.3 125.9 132.2 0 ...
 $ Anaerobic_TISS                       : num  3.3 7.71 4.58 3.39 0 ...
 $ CP_setting                           : num  250 250 250 250 0 250 250 250 0 250 ...
 $ xPower                               : num  168 200 211 193 0 ...
 $ Relative_Intensity                   : num  0.67 0.799 0.845 0.77 0 ...
 $ BikeScore&#8482;                     : num  68.1 232.2 123.2 128.1 0 ...
 $ Skiba_VI                             : num  1.19 1.22 1.23 1.15 0 ...
 $ TISS_Aerobicity                      : num  96 97 96.5 97.5 0 ...
 $ Response_Index                       : num  Inf 1.39 1.64 1.55 0 ...
 $ NP                                   : num  179 210 221 201 0 ...
 $ IF                                   : num  0.715 0.839 0.884 0.804 0 ...
 $ TSS                                  : num  75.2 254.3 134.6 139.3 0 ...
 $ VI                                   : num  1.27 1.28 1.28 1.2 0 ...
 $ Efficiency_Factor                    : num  0 1.46 1.71 1.62 0 ...
  [list output truncated]
> 
```

e.g. looking at the color series, and Workout_Code metadata
```
> print(metrics$color)
  [1] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
  [8] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [15] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [22] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [29] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [36] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#5555ff"
 [43] "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [50] "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [57] "#7f7f7f" "#5555ff" "#7f7f7f" "#5555ff" "#5555ff" "#7f7f7f" "#7f7f7f"
 [64] "#5555ff" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [71] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [78] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff"
 [85] "#5555ff" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [92] "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f"
 [99] "#5555ff" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff"
[106] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff"
[113] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#5555ff"
[120] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#5555ff" "#7f7f7f" "#7f7f7f"
[127] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#5555ff" "#00aa00" "#5555ff"
[134] "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f"
[141] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[148] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#00aa00"
[155] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f"
[162] "#00aa00" "#7f7f7f" "#7f7f7f" "#00aa00" "#00aa00" "#7f7f7f" "#7f7f7f"
[169] "#7f7f7f" "#5555ff" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[176] "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00"
[183] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#5555ff" "#5555ff"
[190] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f"
[197] "#7f7f7f" "#00aa00" "#7f7f7f" "#00aa00" "#7f7f7f" "#5555ff" "#7f7f7f"
[204] "#5555ff" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[211] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#5555ff" "#7f7f7f" "#00aa00"
[218] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#5555ff"
[225] "#00aa00" "#7f7f7f" "#5555ff" "#5555ff" "#ff00ff" "#5555ff" "#5555ff"
[232] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[239] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00"
> print(metrics$Workout_Code)
  [1] ""       ""       ""       ""       ""       ""       ""       ""      
  [9] ""       ""       ""       ""       ""       ""       ""       ""      
 [17] ""       ""       ""       ""       ""       ""       ""       ""      
 [25] ""       ""       ""       ""       ""       ""       ""       ""      
 [33] "1L3+"   "3L3+"   "1L3"    "2L3"    "2L3"    "1L3"    "3L2+"   "2SST"  
 [41] "2L3+"   "2SST+"  "2SST"   "2L3"    "2L2"    "1L3"    "1L3"    "1L3"   
 [49] "1L3"    "1L3+"   "1SST"   "1L3"    "1L3"    "1L3"    "2L3+"   "2L3"   
 [57] "2L3+"   "FTP"    "1AR"    "1SST"   "1SST"   "2L3+"   "1L3"    "1SST"  
 [65] "2L3"    "2SST"   "2L3"    "1AR"    "2L2+"   "1AR"    "1L3+"   "1L2"   
 [73] "2L3"    "2L2"    "2L1"    "3L2+"   "2L3"    "WARM"   "1L3"    "2L3"   
 [81] "2L3"    "2L2+"   "WARM"   "2x20L4" "1L4"    "WARM"   "220L4"  "2L3+"  
 [89] "2L3"    "WARM"   "1L3"    "90P234" "FTP"    "WARM"   "2L3"    "90SST" 
 [97] "WARM"   "2P234"  "1SST"   "2SST"   "1L3"    "90L3"   "90L3"   "1L3"   
[105] "FTP"    "2L2"    "90L3+"  "50G3"   "1G7"    ""       "1L2"    "FTP"   
[113] "2L3"    "2L3"    "2L3"    "2HILLS" "90AR"   "2L3+"   "2L4"    "2L3"   
[121] "1AR"    "1AR"    "4HILLS" "FTP"    "2L3"    "2L3"    "1AR"    "3HILLS"
[129] "1L3"    "2L3"    "1SST"   "1HILLS" "FTP"    "2L3"    "90L3"   "2HILLS"
[137] "90L2"   "fun"    "2HILLS" ""       "1L2"    "1HILLS" "1L3"    "2L3"   
[145] "2L3"    "2AR"    "1AR"    "90I3"   "WARM"   "1L3"    "2SST"   "2L3"   
[153] "2L3"    "2HILLS" "WARM"   "1L3"    "1L3"    "1L3"    "2L3"    "5HILLS"
[161] "1AR"    "3HILLS" "1L3"    ""       "1HILLS" "1HILLS" "1L3"    "2L3"   
[169] "1AR"    "FTP"    "2L3"    "1HILLS" "2L3"    "2L3"    "2L2"    "1L3"   
[177] "1SST"   "1AR"    "2L3"    "2L3"    "2L2"    "3HILLS" "2L2"    "2L2"   
[185] "1L2+"   "1L3"    "6HILLS" "1SST"   "FTP"    "1AR"    "2HILLS" "1L3"   
[193] "1AR"    "2L3"    "1SST"   "2L2"    "2AR"    "2HILLS" "2AR"    "1HILLS"
[201] ""       "1SST"   "1L3"    "1SST"   "2AR"    "3HILLS" "1AR"    "1AR"   
[209] ""       "2L3"    "2L3"    "2L3"    "1AR"    "1SST"   "1SST"   "1L3"   
[217] "2HILLS" "1L3"    ""       "1L3"    "1SST"   "2L3"    "3L2"    "1SST"  
[225] "1HILLS" "2L2"    "1SST"   "1SST"   "RACE"   "1SST"   "1SST"   "1L3"   
[233] "2HILLS" "2L3"    ""       "1L2"    "1L2"    ""       "1L2"    ""      
[241] ""       ""       ""       "1L2"    "2HILLS"
> 
```
### GC.season.peaks(all=FALSE,compare=FALSE,series,duration)

To get the peaks for all activities in a season, the series should be a name for which mean maximal data is available ("power", "heart.rate", "speed" et al) and the duration should be the duration is seconds.

It will return a data.frame with vectors for each series+duration combination as well as a datetime vector for the datetime the peak was recorded. Bear in mind there will be one peak for every activity, rather than per day.

As with most of the methods compare=TRUE will return a list for each date range being compared or the current date range if compare is not active.

e.g. get some heartrate and power peaks:
```
> peaks <- GC.season.peaks(series=c("power", "heart.rate"), duration=c(1,10,100,1000))
> str(peaks)
'data.frame':	74 obs. of  9 variables:
 $ time                : POSIXct, format: "2008-08-14 16:45:52" "2008-08-16 12:00:26" ...
 $ peak_power_1        : num  692 804 760 647 0 582 731 607 0 692 ...
 $ peak_power_10       : num  509 668 606 595 0 ...
 $ peak_power_100      : num  245 322 296 267 0 ...
 $ peak_power_1000     : num  158 223 229 194 0 ...
 $ peak_heart.rate_1   : num  0 177 170 163 0 170 169 177 171 175 ...
 $ peak_heart.rate_10  : num  0 176 169 163 0 ...
 $ peak_heart.rate_100 : num  0 174 165 148 0 ...
 $ peak_heart.rate_1000: num  0 154 149 131 0 ...
> 
```

### GC.season.pmc(all=FALSE, metric="TSS")

To fetch PMC metrics for the currently selected date range, or all dates if all=TRUE, this method returns a data.frame containing columns for all the PMC metrics series and additionally a date column.

You can specify a metric to use (TSS is used by default).

e.g. PMC data using Work (Joules) as the input:
```
> pmc<-GC.season.pmc(metric="Work")
> str(pmc)
'data.frame':	397 obs. of  6 variables:
 $ date  : Date, format: "2008-08-01" "2008-08-02" ...
 $ stress: num  0 0 0 0 0 0 0 0 0 0 ...
 $ lts   : num  28.9 28.2 27.5 26.9 26.3 ...
 $ sts   : num  14.67 12.72 11.03 9.56 8.29 ...
 $ sb    : num  12.6 14.2 15.5 16.5 17.3 ...
 $ rr    : num  -5.24 -5.11 -4.99 -4.88 -4.76 ...
> 
```

### PMC and Metric Plotting together

Putting metrics and pmc together and using some R base graphics, here is an example plot that plots each activity in term of the intensity (IF) and training freshness (TSB) with each dot in the scatter plot representing overall stress of the ride (TSS).

Note how the PMC and Metric data is merged, this is using stock R functionality and relies on the common 'date' field in the metrics and pmc data.frames.

Also note how the shorthand functions GC.metrics() and GC.pmc() are being used instead of GC.season.metrics() and GC.season.pmc()

![PMC a Bubble Chart](https://raw.githubusercontent.com/GoldenCheetah/GoldenCheetah/master/doc/wiki/Special_R_bubble.png)

Its an interesting way of reviewing PMC data, especially when you compare the makeup of one training block with another.

```
##
## TSB v IF with TSS
##
## How fresh were we and how hard did we go
## and how much stress did we elicit.
## A more meaningful way of reviewing the
## PMC data in terms of managing load/intensity

## get data
compares <- GC.metrics(compare=TRUE)

## all pmc data
pmc <- GC.pmc(all=TRUE, metric="TSS")

# bigger margins please
par(mar=c(6,6,6,6))

plot(x=c(-30), y=c(0), 
     ylim=c(0.6,1.1), xlim=c(-25,+25),
     xlab="", main="", ylab="")

## grid lines
grid(col="#404040", lty="solid", lwd=1)

## title
title(main="TSB v IF", 
      xlab="TSB",
      ylab="IF")

## abline
abline(h=0.85, slope=0, lty="dashed", col="white")
abline(v=0, slope=1, lty="dashed", col="white")

for (compare in compares) {

    # combine pmc and metric data
    z <- merge(compare$metrics, pmc, by="date")

    # area of circle should be proportional
    radius <- sqrt( z$TSS/ 31.415927 )

    # plot using ride colors if not comparing
    # or only one date range selected
    if (length(compares) == 1) {

        symbols(z$"4", z$IF, 
                circles=radius,
                inches=0.2,
                add=TRUE,
                bg=z$color,fg=z$color,
                xlab="", ylab="")
    } else {

        symbols(z$"4", z$IF, 
                circles=radius,
                inches=0.25,
                add=TRUE,
                bg=compare$color,
                fg=compare$color,
                xlab="", ylab="")


    }
}
```