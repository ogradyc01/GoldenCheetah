#Using the R Chart

![R chart screenshot](https://raw.githubusercontent.com/GoldenCheetah/GoldenCheetah/master/doc/wiki/RChart.png)

The R chart is introduced with v4.0 of GoldenCheetah. The chart can be added to the activity view and the trend view. 

This 10 minute tutorial video introduces the R chart and setup and shows it in use.

[![Tutorial](https://raw.githubusercontent.com/GoldenCheetah/GoldenCheetah/master/doc/wiki/Rvideo.png)](https://vimeo.com/164812094)

In trend view the chart is refreshed when a date range or season is selected, or if the compare pane is updated. Whilst in the activity view the chart is refreshed when an activity is selected or, again, if the compare pane for intervals is updated.

When the chart is refreshed the user supplied R script is executed, and it should collect data and prepare a plot.

A simple example to plot HR might be:

```
> ride <- GC.activity()
> plot(ride$heart.rate)
```
This basically calls a GC function to fetch the data for the current ride and then uses the base R plot function to plot heart rate as a time series.

Similarly, in trend view, to plot a simple time series of average power for the current season:

```
> metrics <- GC.metrics()
> plot(metrics$Average_Power)
```

**Compare Mode**

Where applicable the data access routines will offer a 'compare' parameter to access data; if FALSE it just returns the currently selected ride, if TRUE it will return a list. If compare mode is not active then the list will contain only one set of data for the currently selected ride. If compare is active it returns a list of all things being compared. See GC.activity(compare=TRUE) below for an example.

## Base GC methods

All methods to access and work with GC objects and data within an R chart are prefixed with "GC." this is to ensure there is no namespace clash with other packages you may have installed. There are a number of methods available as listed below.

###GC.build() and GC.version()

GC.build will return the build number which increments with each release (including pre-release development builds), you can use this if you need to make a script dependant on the build. Additionally, GC.version will return a string describing the release,which could be put in files or on screen etc.

e.g:
```
> GC.build()
[1] 3941
> GC.version()
[1] "V4.0 DEV1604"
> 
```

###GC.athlete() and GC.athlete.home()

GC.athlete() will return a character string representing the current athlete, whilst GC.athlete.home() will return the full path to the athlete home directory, so you can read/write files stored there or add your own subdirectory or data files to use within a chart.

e.g.
```
> GC.athlete()
[1] "Mark Liversedge"
> GC.athlete.home()
[1] "/home/markl/Athletes/Mark Liversedge"
> 
```

## GC.display() and GC.page(width=500, height=500)

If you are familiar with the R device model (dev.cur, dev.list, dev.set) and frequently switch between graphics devices then you can create a new GC graphics device (to plot within the chart) by using GC.display(). If you are not familiar with the R device model then you should probably avoid using this function.

If you want to change the page size used for plotting you can set it with GC.page(). You express the page size in 72 dpi pixels. If you choose a very large size (e.g. 2500x1200) then be sure to have a large screen, since when scaled it will make the fonts very small indeed.

We typically use 500x500, 800x600 and 900x600 for scatter, histogram and time series plots. Be sure to set he page size before any plotting takes place. If you change page size mid-plot you will likely have issues. The command always returns 0.

NOTE: the page size is reset to 500x500 before every script run, so be sure to set it specifically in each plot. 

e.g. to set page size to 800x600
```
> GC.page(width=800, height=600)
integer(0)
>
```

## Working in Activity View

In the activity view you will work primarily with activities. The functions listed below return data related to the currently selected activity or are directly related to that context.

###GC.activities()

Will return a vector of POSIXct datetimes representing the start time for each activity. As the API matures it is expected that you will be able to reference a specific athletes activity via its start time.

e.g.
```
> d <- GC.activities()
> str(d)
 POSIXct[1:705], format: "2005-06-25 14:26:00" "2005-06-27 08:39:00" ...
> 
```

###GC.activity(compare=FALSE)

By default (compare=FALSE) it will return a data.frame representing the data for the currently selected ride. The column names have been selected to remain compatible with the trackeR package from UCL for analysing GPS based sports data.

The data.frame returned looks like this when using the 'str' command:

```
R Console (3.3.0)
> df <- GC.activity()
> str(df)
'data.frame':	3713 obs. of  21 variables:
 $ time        : POSIXct, format: "2016-05-04 15:00:19" "2016-05-04 15:00:20" ...
 $ seconds     : num  0 1 2 3 4 5 6 7 8 9 ...
 $ cadence     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ cadenced    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ heart.rate  : num  NA NA NA NA NA NA NA NA NA NA ...
 $ heart.rated : num  NA NA NA NA NA NA NA NA NA NA ...
 $ distance    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ speed       : num  5.1 5.1 5.38 5.65 5.93 ...
 $ acceleration: num  0 0 0.0772 0.0772 0.0772 ...
 $ torque      : num  NA NA NA NA NA NA NA NA NA NA ...
 $ torqued     : num  NA NA NA NA NA NA NA NA NA NA ...
 $ power       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ powerd      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ altitude    : num  66 66 66 66 66 66 66 66 66 66 ...
 $ longitude   : num  -0.479 -0.479 -0.479 -0.479 -0.479 ...
 $ latitude    : num  51.1 51.1 51.1 51.1 51.1 ...
 $ headwind    : num  5.1 5.1 5.38 5.65 5.93 ...
 $ slope       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ temperature : num  27 27 27 27 27 27 27 27 27 27 ...
 $ apower      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ gearratio   : num  0 0 0 0 0 0 0 0 0 0 ...
> 
```

Depending upon the data you have available in the activity you may see more columns, for example pedal based power meters and muscle oxygen devices will return additional data. In this example above you will see that heartrate and torque data is not recorded but still present in the data.frame -- the columns listed above will always be made available but will contan R's NA value if not actually recorded in the activity.

**GC.activity(compare=TRUE)**

If you pass the parameter compare=TRUE then the format returned is a list rather than a dataframe. The lis contains an entry for each ride being compared, or just the currently selected ride if compare is not active.

Each entry in the list contains two elements; 'color' a string you can use in 'col="xxx"' assignments, and 'activity' the data.frame in the same format as above.

e.g. with compare **not** active:

```
> df <- GC.activity(compare=TRUE)
> str(df)
Dotted pair list of 1
 $ :Dotted pair list of 2
  ..$ activity:'data.frame':	3713 obs. of  21 variables:
  .. ..$ time        : POSIXct[1:3713], format: "2016-05-04 15:00:19" "2016-05-04 15:00:20" ...
  .. ..$ seconds     : num [1:3713] 0 1 2 3 4 5 6 7 8 9 ...
  .. ..$ cadence     : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ cadenced    : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ heart.rate  : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ heart.rated : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ distance    : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ speed       : num [1:3713] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ acceleration: num [1:3713] 0 0 0.0772 0.0772 0.0772 ...
  .. ..$ torque      : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ torqued     : num [1:3713] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ power       : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ powerd      : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ altitude    : num [1:3713] 66 66 66 66 66 66 66 66 66 66 ...
  .. ..$ longitude   : num [1:3713] -0.479 -0.479 -0.479 -0.479 -0.479 ...
  .. ..$ latitude    : num [1:3713] 51.1 51.1 51.1 51.1 51.1 ...
  .. ..$ headwind    : num [1:3713] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ slope       : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ temperature : num [1:3713] 27 27 27 27 27 27 27 27 27 27 ...
  .. ..$ apower      : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ gearratio   : num [1:3713] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ color   : chr "#FF00FF"
> 
```

e.g. with compare active and two rides in the compare pane:

```
> df <- GC.activity(compare=TRUE)
> str(df)
Dotted pair list of 2
 $ :Dotted pair list of 2
  ..$ activity:'data.frame':	3712 obs. of  21 variables:
  .. ..$ time        : POSIXct[1:3712], format: "2016-05-04 15:00:19" "2016-05-04 15:00:20" ...
  .. ..$ seconds     : num [1:3712] 0 1 2 3 4 5 6 7 8 9 ...
  .. ..$ cadence     : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ cadenced    : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ heart.rate  : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ heart.rated : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ distance    : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ speed       : num [1:3712] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ acceleration: num [1:3712] 0 0 0.0772 0.0772 0.0772 ...
  .. ..$ torque      : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ torqued     : num [1:3712] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ power       : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ powerd      : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ altitude    : num [1:3712] 66 66 66 66 66 66 66 66 66 66 ...
  .. ..$ longitude   : num [1:3712] -0.479 -0.479 -0.479 -0.479 -0.479 ...
  .. ..$ latitude    : num [1:3712] 51.1 51.1 51.1 51.1 51.1 ...
  .. ..$ headwind    : num [1:3712] 5.1 5.1 5.38 5.65 5.93 ...
  .. ..$ slope       : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ temperature : num [1:3712] 27 27 27 27 27 27 27 27 27 27 ...
  .. ..$ apower      : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ gearratio   : num [1:3712] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ color   : chr "#ff00ff"
 $ :Dotted pair list of 2
  ..$ activity:'data.frame':	4534 obs. of  21 variables:
  .. ..$ time        : POSIXct[1:4534], format: "2016-05-03 14:45:57" "2016-05-03 14:45:58" ...
  .. ..$ seconds     : num [1:4534] 0 1 2 3 4 5 6 7 8 9 ...
  .. ..$ cadence     : num [1:4534] 78 71 72 133 133 133 60 93 93 93 ...
  .. ..$ cadenced    : num [1:4534] 0 0 1 61 0 0 0 33 0 0 ...
  .. ..$ heart.rate  : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ heart.rated : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ distance    : num [1:4534] 0 0.006 0.012 0.012 0.012 0.014 0.02 0.02 0.02 0.02 ...
  .. ..$ speed       : num [1:4534] 0 24.8 30.7 30.7 30.7 ...
  .. ..$ acceleration: num [1:4534] 0 6.89 1.64 0 0 ...
  .. ..$ torque      : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ torqued     : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ power       : num [1:4534] 0 34 20 0 0 0 11 11 11 11 ...
  .. ..$ powerd      : num [1:4534] 0 34 0 0 0 0 11 0 0 0 ...
  .. ..$ altitude    : num [1:4534] -33 -32 -32 -32 -32 -32 -32 -32 -32 -32 ...
  .. ..$ longitude   : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ latitude    : num [1:4534] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ headwind    : num [1:4534] 0 24.8 30.7 30.7 30.7 ...
  .. ..$ slope       : num [1:4534] 0 16.7 0 0 0 ...
  .. ..$ temperature : num [1:4534] 17 18 18 18 18 18 18 18 18 18 ...
  .. ..$ apower      : num [1:4534] 0 34 20 0 0 0 11 11 11 11 ...
  .. ..$ gearratio   : num [1:4534] 0 2.7 3 3 3 3 3.5 2.3 2.3 2.3 ...
  ..$ color   : chr "#00ffff"
> 
```

In this way, if you want to remain compatible with compare mode when charting you should always use 'compare=TRUE' and loop through the results to plot, taking care to overplot using 'lines', 'points' or 'curve'.

Here is a script that plots density distributions for power and is compatible with compare mode:
```
## R script will run on selection.
##
## GC.activity(compare=TRUE)
## GC.metrics(all=FALSE)
##
## Get the current ride or metrics
##

# get a list of activities, will have one member
# if not in compare mode, or multiple if we are
# in compare mode
d <- GC.activity(compare=TRUE)

## set plot limits
maxy <-0
maxx <-0

for (compare in d) {

   # get the activity being compared
   power <- compare$activity$power

   # density
   k <- density(power)

   # max on x axis
   mx <- max(power)
   if (mx > maxx) maxx <- mx;

   # max on y axis
   my <- max(k$y)
   if (my > maxy) maxy <- my;
}

## create a blank plot
plot(k, ylim = c(0,maxy), xlim=c(0,maxx), 
     col="black", main="", xlab="", yaxt="n")

title(main="Power Distribution", 
      xlab = "Watts")

## add density
for (compare in d) {

    # just the ride
    power <- compare$activity$power

    k <- density(power)
    if (length(d)==1) lines(k, col="green")
    else lines(k, col=compare$color)
}
```
**As you may have guessed the script in an R chart will be re-run when an activity is selected or compare pane changes (you add or deselect an activity etc).**

###GC.activity.wbal(compare=FALSE)

Because the W'bal data series is always calculated in 1 second intervals it is not returned with the activity data data.frame -- it would cause problems when data is recorded in 0.5 seconds from a track PM or 1.26s by an old Powertap.

Instead, we return it a simple vector of values, and when using compare mode is in a list in the same way as the other activity data.

e.g. plain, no compare active:
```
> wbal <- GC.activity.wbal()
> str(wbal)
 num [1:4227] 19000 19000 19000 19000 19000 19000 19000 19000 19000 19000 ...
> 
```

e.g. with compare:
```
> wc <- GC.activity.wbal(compare=TRUE)
> str(wc)
Dotted pair list of 2
 $ :Dotted pair list of 2
  ..$ activity: num [1:4226] 19000 19000 19000 19000 19000 19000 19000 19000 19000 19000 ...
  ..$ color   : chr "#ff00ff"
 $ :Dotted pair list of 2
  ..$ activity: num [1:4534] 19000 19000 19000 19000 19000 19000 19000 19000 19000 19000 ...
  ..$ color   : chr "#00ffff"
> 
```

###GC.activity.meanmax(compare=FALSE)

Mean maximal data is returned in a data.frame, with a column for each data series that has mean max data computed. This is a subset of all the data that can be made available (the cache size is expensive and we don't want to cache data that is never or very, very rarely used).

As with the other activity functions it will return a list of a single data.frame of mean maximal series for the ride.

The series is always computed to 1 second intervals, so the returned data contains peak values from 1s through to the end of the activity

e.g. Mean-max for an activity:
```
> mm <- GC.activity.meanmax()
> str(mm)
'data.frame':	4228 obs. of  8 variables:
 $ power  : num  557 529 517 504 ...
 $ wpk    : num  6.24 5.93 5.79 5.64 ...
 $ cadence: num  97 97 95 93 ...
 $ speed  : num  53.5 53.2 53 52.6 ...
 $ vam    : num  3600 3600 2400 2700 ...
 $ NP     : num  393 392 391 390 ...
 $ apower : num  559 531 519 506 ...
 $ xpower : num  340 339 338 338 ...
> 
```

## Working in the Trends View

When plotting in the trends view you are looking at data across a date range or season (as selected in the sidebar). These functions return data in that context.

### GC.metrics(all=FALSE, compare=FALSE)

Will fetch the metrics for rides in the currently selected date range, or all dates if all=TRUE. As you would expect the compare parameter will return a list.

Of note here are the metadata fields are also returned in the data.frame, a date field as well as a datetime field and the ride color as applied using the GC coloring rules. Color is a text string in "#rrggbb" format.

It is common to use the color column to control coloring on the plots.

e.g. fetching metrics for the current date range:
```
> metrics <- GC.metrics()
> str(metrics)
'data.frame':	245 obs. of  301 variables:
 $ date                                 : Date, format: "2008-08-14" "2008-08-16" ...
 $ time                                 : POSIXct, format: "2008-08-14 16:45:52" "2008-08-16 12:00:26" ...
 $ axPower                              : num  168 200 211 193 0 ...
 $ aPower_Relative_Intensity            : num  0.67 0.799 0.845 0.77 0 ...
 $ aBikeScore                           : num  68.1 232.2 123.2 128.1 0 ...
 $ Skiba_aVI                            : num  1.19 1.22 1.23 1.15 0 ...
 $ aPower_Response_Index                : num  Inf 1.39 1.64 1.55 0 ...
 $ aNP                                  : num  179 210 221 201 0 ...
 $ aIF                                  : num  0.715 0.839 0.884 0.804 0 ...
 $ aTSS                                 : num  75.2 254.3 134.6 139.3 0 ...
 $ aVI                                  : num  1.27 1.28 1.28 1.2 0 ...
 $ aPower_Efficiency_Factor             : num  Inf 1.46 1.71 1.62 0 ...
 $ aTSS_per_hour                        : num  49.6 63.9 78.1 64.6 0 ...
 $ Aerobic_Decoupling                   : num  0 17.59 15.39 9.27 0 ...
 $ Activities                           : num  1 1 1 1 1 1 1 1 1 1 ...
 $ To_Exhaustion                        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Duration                             : num  5454 14330 6210 7764 1611 ...
 $ Time_Moving                          : num  5287 12891 6165 7699 520 ...
 $ Time_Carrying                        : num  0 0 0 0 0 0 0 0 118 0 ...
 $ Elevation_Gain_Carrying              : num  0 0 0 0 0 ...
 $ Distance                             : num  28.48 77.412 33.96 45.284 0.727 ...
 $ Distance_Swim                        : num  28480 77412 33960 45284 727 ...
 $ Climb_Rating                         : num  0 0 0 0 0.235 ...
 $ Athlete_Weight                       : num  89 89 89 89 85 89 89 89 89 89 ...
 $ Athlete_Bodyfat                      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Athlete_Lean_Weight                  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Athlete_Bodyfat_Percent              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Elevation_Gain                       : num  0 0 0 0 13.1 ...
 $ Elevation_Loss                       : num  0 0 0 0 13.1 ...
 $ Work                                 : num  746 2138 1068 1297 0 ...
 $ Average_Speed                        : num  19.65 22.91 20.44 21.86 5.04 ...
 $ Pace                                 : num  3.05 2.62 2.93 2.74 11.92 ...
 $ Pace_Swim                            : num  0.305 0.262 0.293 0.274 1.192 ...
 $ Average_Power                        : num  141 164 172 167 0 ...
 $ Average_SmO2                         : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_tHb                          : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_aPower                       : num  141 164 172 167 0 ...
 $ Nonzero_Average_Power                : num  143 176 179 174 0 ...
 $ Average_Heart_Rate                   : num  0 144 129 124 0 ...
 $ Average_Core_Temperature             : num  0 38 37.9 37.8 0 ...
 $ Heartbeats                           : num  0 31150 13314 16023 0 ...
 $ HrPw_Ratio                           : num  0 1.14 1.33 1.35 0 ...
 $ Workbeat_stress                      : num  0 666 142 208 0 ...
 $ Watts:RPE_Ratio                      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Power_Percent_of_Max                 : num  15.7 18.3 19.1 18.6 0 ...
 $ HrNp_Ratio                           : num  0 1.46 1.71 1.62 0 ...
 $ Average_Cadence                      : num  64.6 68.9 68.8 76 0 ...
 $ Average_Temp                         : num  -255 -255 -255 -255 -255 -255 -255 -255 -255 -255 ...
 $ Max_Power                            : num  692 804 760 647 0 582 731 607 0 692 ...
 $ Max_SmO2                             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Max_tHb                              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Min_SmO2                             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Min_tHb                              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Max_Heartrate                        : num  0 177 170 163 0 170 169 177 171 175 ...
 $ Min_Heartrate                        : num  0 70 59 84 0 82 75 73 65 67 ...
 $ Max_Core_Temperature                 : num  0 38.9 38.4 38.2 0 ...
 $ Max_Speed                            : num  43 59.2 44.1 51 10.1 ...
 $ Max_Cadence                          : num  244 244 244 244 0 244 244 244 0 183 ...
 $ Max_Temp                             : num  -255 -255 -255 -255 -255 -255 -255 -255 -255 -255 ...
 $ Min_Temp                             : num  -255 -255 -255 -255 -255 -255 -255 -255 -255 -255 ...
 $ 95%_Heartrate                        : num  0 168 158 143 0 161 158 163 168 160 ...
 $ VAM                                  : num  0 0 0 0 29.2 ...
 $ EOA                                  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Gradient                             : num  0 0 0 0 1.8 ...
 $ Average_Power_Variance               : num  89.8 81.4 70.5 69.4 0 ...
 $ Max_Power_Variance                   : num  692 804 747 469 0 535 668 580 0 692 ...
 $ Average_Left_Torque_Effectiveness    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Torque_Effectiveness   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Pedal_Smoothness        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Pedal_Smoothness       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Pedal_Center_Offset     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Pedal_Center_Offset    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Power_Phase_Start       : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Power_Phase_Start      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Power_Phase_End         : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Power_Phase_End        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Peak_Power_Phase_Start  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Peak_Power_Phase_Start : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Peak_Power_Phase_End    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Peak_Power_Phase_End   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Left_Power_Phase_Length      : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Power_Phase_Length     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Peak_Left_Power_Phase_Length : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Average_Right_Peak_Power_Phase_Length: num  0 0 0 0 0 0 0 0 0 0 ...
 $ Calories                             : num  0 3162 1283 1507 0 ...
 $ Aerobic_TISS                         : num  80.2 246.3 125.9 132.2 0 ...
 $ Anaerobic_TISS                       : num  3.3 7.71 4.58 3.39 0 ...
 $ CP_setting                           : num  250 250 250 250 0 250 250 250 0 250 ...
 $ xPower                               : num  168 200 211 193 0 ...
 $ Relative_Intensity                   : num  0.67 0.799 0.845 0.77 0 ...
 $ BikeScore&#8482;                     : num  68.1 232.2 123.2 128.1 0 ...
 $ Skiba_VI                             : num  1.19 1.22 1.23 1.15 0 ...
 $ TISS_Aerobicity                      : num  96 97 96.5 97.5 0 ...
 $ Response_Index                       : num  Inf 1.39 1.64 1.55 0 ...
 $ NP                                   : num  179 210 221 201 0 ...
 $ IF                                   : num  0.715 0.839 0.884 0.804 0 ...
 $ TSS                                  : num  75.2 254.3 134.6 139.3 0 ...
 $ VI                                   : num  1.27 1.28 1.28 1.2 0 ...
 $ Efficiency_Factor                    : num  0 1.46 1.71 1.62 0 ...
  [list output truncated]
> 
```

e.g. looking at the color series, and Workout_Code metadata
```
> print(metrics$color)
  [1] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
  [8] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [15] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [22] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [29] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [36] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#5555ff"
 [43] "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [50] "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [57] "#7f7f7f" "#5555ff" "#7f7f7f" "#5555ff" "#5555ff" "#7f7f7f" "#7f7f7f"
 [64] "#5555ff" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [71] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [78] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff"
 [85] "#5555ff" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
 [92] "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f"
 [99] "#5555ff" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff"
[106] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff"
[113] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#5555ff"
[120] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#5555ff" "#7f7f7f" "#7f7f7f"
[127] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#5555ff" "#00aa00" "#5555ff"
[134] "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f"
[141] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[148] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#00aa00"
[155] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#7f7f7f"
[162] "#00aa00" "#7f7f7f" "#7f7f7f" "#00aa00" "#00aa00" "#7f7f7f" "#7f7f7f"
[169] "#7f7f7f" "#5555ff" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[176] "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00"
[183] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00" "#5555ff" "#5555ff"
[190] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f"
[197] "#7f7f7f" "#00aa00" "#7f7f7f" "#00aa00" "#7f7f7f" "#5555ff" "#7f7f7f"
[204] "#5555ff" "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[211] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#5555ff" "#7f7f7f" "#00aa00"
[218] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#5555ff" "#7f7f7f" "#7f7f7f" "#5555ff"
[225] "#00aa00" "#7f7f7f" "#5555ff" "#5555ff" "#ff00ff" "#5555ff" "#5555ff"
[232] "#7f7f7f" "#00aa00" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f"
[239] "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#7f7f7f" "#00aa00"
> print(metrics$Workout_Code)
  [1] ""       ""       ""       ""       ""       ""       ""       ""      
  [9] ""       ""       ""       ""       ""       ""       ""       ""      
 [17] ""       ""       ""       ""       ""       ""       ""       ""      
 [25] ""       ""       ""       ""       ""       ""       ""       ""      
 [33] "1L3+"   "3L3+"   "1L3"    "2L3"    "2L3"    "1L3"    "3L2+"   "2SST"  
 [41] "2L3+"   "2SST+"  "2SST"   "2L3"    "2L2"    "1L3"    "1L3"    "1L3"   
 [49] "1L3"    "1L3+"   "1SST"   "1L3"    "1L3"    "1L3"    "2L3+"   "2L3"   
 [57] "2L3+"   "FTP"    "1AR"    "1SST"   "1SST"   "2L3+"   "1L3"    "1SST"  
 [65] "2L3"    "2SST"   "2L3"    "1AR"    "2L2+"   "1AR"    "1L3+"   "1L2"   
 [73] "2L3"    "2L2"    "2L1"    "3L2+"   "2L3"    "WARM"   "1L3"    "2L3"   
 [81] "2L3"    "2L2+"   "WARM"   "2x20L4" "1L4"    "WARM"   "220L4"  "2L3+"  
 [89] "2L3"    "WARM"   "1L3"    "90P234" "FTP"    "WARM"   "2L3"    "90SST" 
 [97] "WARM"   "2P234"  "1SST"   "2SST"   "1L3"    "90L3"   "90L3"   "1L3"   
[105] "FTP"    "2L2"    "90L3+"  "50G3"   "1G7"    ""       "1L2"    "FTP"   
[113] "2L3"    "2L3"    "2L3"    "2HILLS" "90AR"   "2L3+"   "2L4"    "2L3"   
[121] "1AR"    "1AR"    "4HILLS" "FTP"    "2L3"    "2L3"    "1AR"    "3HILLS"
[129] "1L3"    "2L3"    "1SST"   "1HILLS" "FTP"    "2L3"    "90L3"   "2HILLS"
[137] "90L2"   "fun"    "2HILLS" ""       "1L2"    "1HILLS" "1L3"    "2L3"   
[145] "2L3"    "2AR"    "1AR"    "90I3"   "WARM"   "1L3"    "2SST"   "2L3"   
[153] "2L3"    "2HILLS" "WARM"   "1L3"    "1L3"    "1L3"    "2L3"    "5HILLS"
[161] "1AR"    "3HILLS" "1L3"    ""       "1HILLS" "1HILLS" "1L3"    "2L3"   
[169] "1AR"    "FTP"    "2L3"    "1HILLS" "2L3"    "2L3"    "2L2"    "1L3"   
[177] "1SST"   "1AR"    "2L3"    "2L3"    "2L2"    "3HILLS" "2L2"    "2L2"   
[185] "1L2+"   "1L3"    "6HILLS" "1SST"   "FTP"    "1AR"    "2HILLS" "1L3"   
[193] "1AR"    "2L3"    "1SST"   "2L2"    "2AR"    "2HILLS" "2AR"    "1HILLS"
[201] ""       "1SST"   "1L3"    "1SST"   "2AR"    "3HILLS" "1AR"    "1AR"   
[209] ""       "2L3"    "2L3"    "2L3"    "1AR"    "1SST"   "1SST"   "1L3"   
[217] "2HILLS" "1L3"    ""       "1L3"    "1SST"   "2L3"    "3L2"    "1SST"  
[225] "1HILLS" "2L2"    "1SST"   "1SST"   "RACE"   "1SST"   "1SST"   "1L3"   
[233] "2HILLS" "2L3"    ""       "1L2"    "1L2"    ""       "1L2"    ""      
[241] ""       ""       ""       "1L2"    "2HILLS"
> 
```
### GC.pmc(all=FALSE, metric="TSS")

To fetch PMC metrics for the currently selected date range, or all dates if all=TRUE, this method returns a data.frame containing columns for all the PMC metrics series and additionally a date column.

You can specify a metric to use (TSS is used by default).

e.g. PMC data using Work (Joules) as the input:
```
> pmc<-GC.pmc(metric="Work")
> str(pmc)
'data.frame':	397 obs. of  6 variables:
 $ date  : Date, format: "2008-08-01" "2008-08-02" ...
 $ stress: num  0 0 0 0 0 0 0 0 0 0 ...
 $ lts   : num  28.9 28.2 27.5 26.9 26.3 ...
 $ sts   : num  14.67 12.72 11.03 9.56 8.29 ...
 $ sb    : num  12.6 14.2 15.5 16.5 17.3 ...
 $ rr    : num  -5.24 -5.11 -4.99 -4.88 -4.76 ...
> 
```

### PMC and Metric Plotting together

Putting metrics and pmc together and using some R base graphics, here is an example plot that plots each activity in term of the intensity (IF) and training freshness (TSB) with each dot in the scatter plot representing overall stress of the ride (TSS).

Note how the PMC and Metric data is merged, this is using stock R functionality and relies on the common 'date' field in the metrics and pmc data.frames.

![PMC a Bubble Chart](https://raw.githubusercontent.com/GoldenCheetah/GoldenCheetah/master/doc/wiki/Special_R_bubble.png)

Its an interesting way of reviewing PMC data, especially when you compare the makeup of one training block with another.

```
##
## TSB v IF with TSS
##
## How fresh were we and how hard did we go
## and how much stress did we elicit.
## A more meaningful way of reviewing the
## PMC data in terms of managing load/intensity

## get data
compares <- GC.metrics(compare=TRUE)

## all pmc data
pmc <- GC.pmc(all=TRUE, metric="TSS")

# bigger margins please
par(mar=c(6,6,6,6))

plot(x=c(-30), y=c(0), 
     ylim=c(0.6,1.1), xlim=c(-25,+25),
     xlab="", main="", ylab="")

## grid lines
grid(col="#404040", lty="solid", lwd=1)

## title
title(main="TSB v IF", 
      xlab="TSB",
      ylab="IF")

## abline
abline(h=0.85, slope=0, lty="dashed", col="white")
abline(v=0, slope=1, lty="dashed", col="white")

for (compare in compares) {

    # combine pmc and metric data
    z <- merge(compare$metrics, pmc, by="date")

    # area of circle should be proportional
    radius <- sqrt( z$TSS/ 31.415927 )

    # plot using ride colors if not comparing
    # or only one date range selected
    if (length(compares) == 1) {

        symbols(z$"4", z$IF, 
                circles=radius,
                inches=0.2,
                add=TRUE,
                bg=z$color,fg=z$color,
                xlab="", ylab="")
    } else {

        symbols(z$"4", z$IF, 
                circles=radius,
                inches=0.25,
                add=TRUE,
                bg=compare$color,
                fg=compare$color,
                xlab="", ylab="")


    }
}
```